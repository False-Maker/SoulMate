# SoulMate 项目功能文档

## 1. 核心功能概述
SoulMate 是一个基于 Android 的 AI 伴侣应用，集成了数字人形象、大语言模型 (LLM)、情感记忆系统和多模态交互（语音/文本）。应用旨在提供深度的情感陪伴，通过亲和度和亲密度系统模拟真实的人际关系发展。

## 2. 功能模块详情

### 2.1 AI 核心能力 (The Brain)
- **大语言模型集成**: 
  - 集成 LLM API (Doubao/Volcengine)，支持流式/非流式对话。
  - **双重思维模式**: AI 回复包含 `[Inner]` (内心独白) 和 `[Reply]` (实际回复)，模拟真实思维过程。
  - **动态人设**: 根据当前的亲和度和亲密度，自动切换系统 Prompt（如：高冷 vs 甜蜜）。
- **RAG (检索增强生成)**: 
  - 使用 `DoubaoEmbeddingService` 将记忆转化为向量 (1024维)。
  - 聊天时自动检索相关历史记忆作为上下文，增强对话连贯性。
- **情感计算**:
  - `EmotionTracker`: 追踪用户最近对话的情绪模式（如连续低落）。
  - 若检测到用户情绪异常（如连续3次负面情绪），会触发关怀机制。

### 2.2 记忆与关系系统
- **记忆花园 (Memory Garden)**:
  - 自动记录重要对话和事件。
  - **可视化时间线**: 以时间轴形式展示共同回忆。
  - **情绪标签**: 每段记忆带有情绪分类（开心、难过、爱等）。
  - **管理功能**: 用户可查看、编辑或删除记忆。
- **关系数值体系**:
  - **亲密度 (Intimacy)**: 
    - 正向成长体系 (0-1000+)。
    - 通过持续互动积累。
  - **亲和度 (Affinity)**: 
    - 动态情感状态 (0-100)，分为三个阶段：
      - **冷战期 (<50)**: AI 态度冷淡，拒绝亲密互动。
      - **正常期 (50-79)**: 标准回应。
      - **甜蜜期 (80+)**: 热情、主动。
    - **惩罚机制**: 长期不理人 (-2分/24h) 或言语粗鲁 (-5分) 会导致降分。
    - **恢复机制**: 通过道歉或温情互动恢复分数。
- **纪念日管理 (Anniversary Manager)**:
  - 自动追踪重要日期（如初识日、生日）。
  - 在纪念日当天触发特殊问候和对话内容。

### 2.3 交互体验
- **聊天界面**:
  - **数字人形象**: 顶部展示 3D/2D 数字人 (AvatarCoreService)，支持动态展示。
  - **混合输入**: 支持文本输入和按住说话 (Voice Input)。
  - **打字机效果**: 消息回复模拟打字过程，提升真实感。
- **语音交互**:
  - **ASR (语音识别)**: 集成阿里云 ASR (AliyunASRService)，支持长按录音。
  - 语音转文字后直接发送给 LLM。

### 2.4 主动陪伴 (Proactive)
- **心跳机制 (HeartbeatWorker)**:
  - 后台每 15 分钟运行一次。
  - 检查用户活跃度和情绪状态。
  - 在合适时机（如纪念日、因为长时间未互动而想念用户时）发送主动消息通知。

### 2.5 系统基础设施
- **架构**: MVVM + Clean Architecture。
- **技术栈**: 
  - 语言: Kotlin
  - UI: Jetpack Compose
  - 依赖注入: Hilt
  - 异步处理: Coroutines & Flow
  - 后台任务: WorkManager (HiltWorker)
  - 网络: Retrofit + OkHttp
